<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Token Creator</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #00FFA3;
            --primary-dark: #00CC82;
            --bg-dark: #0A0E1A;
            --bg-card: #141824;
            --bg-input: #0d1120;
            --text-primary: #FFFFFF;
            --text-secondary: #A0AEC0;
            --text-muted: #4A5568;
            --border: #2D3748;
            --success: #00FFA3;
            --error: #FF6B6B;
            --warning: #F6AD55;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10,14,26,0.95);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-links {
            display: flex;
            gap: 1.75rem;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.2s;
            cursor: pointer;
        }

        .nav-links a:hover { color: var(--primary); }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* Network Toggle */
        .net-toggle {
            display: flex;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 3px;
            gap: 2px;
        }

        .net-btn {
            padding: 0.4rem 1rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.85rem;
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }

        .net-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--bg-dark);
        }

        .wallet-btn {
            padding: 0.6rem 1.4rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--bg-dark);
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.9rem;
            font-family: 'Outfit', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 14px rgba(0,255,163,0.25);
        }

        .wallet-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(0,255,163,0.35); }

        .wallet-btn.connected {
            background: var(--bg-card);
            color: var(--primary);
            border: 1px solid var(--primary);
            box-shadow: none;
        }

        /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
        .page { max-width: 1280px; margin: 0 auto; padding: 3rem 2rem 6rem; }

        .hero {
            text-align: center;
            margin-bottom: 3.5rem;
        }

        .hero h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            line-height: 1.15;
            background: linear-gradient(135deg, #fff 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .hero p {
            color: var(--text-secondary);
            font-size: 1.15rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 1.5rem;
            align-items: start;
        }

        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
            .sidebar { order: -1; }
            .nav-links { display: none; }
        }

        /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
        }

        .card-sub {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1.75rem;
        }

        /* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
        .field { margin-bottom: 1.25rem; }

        .field label {
            display: block;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.4rem;
        }

        .field small {
            display: block;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        .req { color: var(--error); }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 0.8rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus, textarea:focus { border-color: var(--primary); }

        textarea { resize: vertical; min-height: 90px; }

        /* ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ */
        .upload-box {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            background: var(--bg-input);
            transition: border-color 0.2s, background 0.2s;
            position: relative;
        }

        .upload-box:hover, .upload-box.drag { border-color: var(--primary); background: rgba(0,255,163,0.03); }

        .upload-box input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .upload-icon { font-size: 2rem; margin-bottom: 0.5rem; }

        .upload-hint { color: var(--text-secondary); font-size: 0.9rem; }

        .preview-wrap { margin-top: 1rem; display: none; }
        .preview-wrap img { max-width: 160px; max-height: 160px; border-radius: 12px; border: 1px solid var(--border); }

        /* ‚îÄ‚îÄ ADVANCED ‚îÄ‚îÄ */
        .adv-btn {
            width: 100%;
            padding: 0.7rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            margin: 1rem 0;
            transition: border-color 0.2s, color 0.2s;
        }

        .adv-btn:hover { border-color: var(--primary); color: var(--primary); }

        .adv-wrap {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.45s ease;
        }

        .adv-wrap.open { max-height: 600px; }

        /* ‚îÄ‚îÄ TOGGLE ROW ‚îÄ‚îÄ */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.9rem 1rem;
            background: var(--bg-input);
            border-radius: 12px;
            margin-bottom: 0.75rem;
        }

        .toggle-row-label { font-weight: 600; font-size: 0.9rem; }
        .toggle-row-desc { color: var(--text-muted); font-size: 0.8rem; margin-top: 0.1rem; }

        .switch { position: relative; width: 52px; height: 28px; flex-shrink: 0; }
        .switch input { display: none; }

        .track {
            position: absolute;
            inset: 0;
            background: var(--border);
            border-radius: 28px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .track::before {
            content: '';
            position: absolute;
            width: 20px; height: 20px;
            background: #fff;
            border-radius: 50%;
            top: 4px; left: 4px;
            transition: transform 0.3s;
        }

        .switch input:checked + .track { background: var(--primary); }
        .switch input:checked + .track::before { transform: translateX(24px); }

        /* ‚îÄ‚îÄ CREATE BUTTON ‚îÄ‚îÄ */
        .create-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--bg-dark);
            border: none;
            border-radius: 14px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 14px rgba(0,255,163,0.3);
            margin-top: 0.5rem;
        }

        .create-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 22px rgba(0,255,163,0.4); }
        .create-btn:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }

        /* ‚îÄ‚îÄ SUMMARY SIDEBAR ‚îÄ‚îÄ */
        .sidebar { position: sticky; top: 90px; }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.7rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .summary-row:last-child { border-bottom: none; }
        .summary-row span:first-child { color: var(--text-secondary); }
        .summary-row span:last-child { font-weight: 600; }
        .summary-row.total span:last-child { color: var(--primary); font-size: 1.2rem; }

        /* ‚îÄ‚îÄ LIQUIDITY SECTION ‚îÄ‚îÄ */
        .section-title {
            font-size: 1.75rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .section-sub {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2.5rem;
        }

        .info-banner {
            background: rgba(0,255,163,0.06);
            border: 1px solid rgba(0,255,163,0.3);
            border-radius: 12px;
            padding: 0.9rem 1.1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1.25rem;
        }

        /* ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ */
        .status-box {
            padding: 0.9rem 1.1rem;
            border-radius: 12px;
            margin: 1rem 0;
            font-size: 0.9rem;
            display: none;
            word-break: break-all;
        }

        .status-box.show { display: block; }
        .status-box.ok { background: rgba(0,255,163,0.08); border: 1px solid var(--success); color: var(--success); }
        .status-box.err { background: rgba(255,107,107,0.08); border: 1px solid var(--error); color: var(--error); }
        .status-box.info { background: rgba(246,173,85,0.08); border: 1px solid var(--warning); color: var(--warning); }

        /* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
        .steps { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.25rem; }

        .step {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: border-color 0.2s, transform 0.2s;
        }

        .step:hover { border-color: var(--primary); transform: translateY(-3px); }

        .step-num {
            width: 42px; height: 42px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--bg-dark);
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 1.1rem;
            margin-bottom: 0.85rem;
        }

        .step h4 { font-size: 1rem; margin-bottom: 0.3rem; }
        .step p { color: var(--text-secondary); font-size: 0.85rem; }

        /* ‚îÄ‚îÄ FAQ ‚îÄ‚îÄ */
        .faq-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }

        .faq-q {
            padding: 1.1rem 1.25rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.95rem;
            user-select: none;
            transition: color 0.2s;
        }

        .faq-q:hover { color: var(--primary); }

        .faq-icon {
            color: var(--primary);
            font-size: 1.2rem;
            transition: transform 0.3s;
            flex-shrink: 0;
        }

        .faq-item.open .faq-icon { transform: rotate(45deg); }

        .faq-a {
            max-height: 0;
            overflow: hidden;
            padding: 0 1.25rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            transition: max-height 0.3s ease;
        }

        .faq-item.open .faq-a { max-height: 300px; padding: 0 1.25rem 1.25rem; }

        /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
        .footer {
            background: var(--bg-card);
            border-top: 1px solid var(--border);
            padding: 2.5rem 2rem;
            text-align: center;
        }

        .footer-links { display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .footer-links a { color: var(--text-secondary); text-decoration: none; font-size: 0.9rem; cursor: pointer; }
        .footer-links a:hover { color: var(--primary); }
        .footer-copy { color: var(--text-muted); font-size: 0.8rem; }

        /* ‚îÄ‚îÄ UTIL ‚îÄ‚îÄ */
        .mt2 { margin-top: 2rem; }
        .mt4 { margin-top: 4rem; }
        .copy-tag {
            display: inline-block;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.25rem 0.6rem;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 0.5rem;
            vertical-align: middle;
            font-family: monospace;
            transition: border-color 0.2s;
        }
        .copy-tag:hover { border-color: var(--primary); color: var(--primary); }
    </style>
</head>
<body>

<!-- ‚ñë‚ñë HEADER ‚ñë‚ñë -->
<header class="header">
    <div class="logo" onclick="go('hero')">
        <div class="logo-icon">‚ö°</div>
        Solana Token Creator
    </div>

    <nav class="nav-links">
        <a onclick="go('creator')">Token Creator</a>
        <a onclick="go('liquidity')">Create Liquidity</a>
        <a onclick="go('how-to')">How to Use</a>
        <a onclick="go('faq')">FAQ</a>
    </nav>

    <div class="header-right">
        <div class="net-toggle">
            <button class="net-btn active" id="devBtn">Devnet</button>
            <button class="net-btn" id="mainBtn">Mainnet</button>
        </div>
        <button class="wallet-btn" id="walletBtn">Connect Wallet</button>
    </div>
</header>

<!-- ‚ñë‚ñë MAIN ‚ñë‚ñë -->
<main class="page">

    <!-- HERO -->
    <section class="hero" id="hero">
        <h1>Solana Token Creator</h1>
        <p>Create Solana SPL tokens in seconds ‚Äî no code needed. Only pay the Solana network fee.</p>
    </section>

    <!-- TOKEN CREATOR -->
    <section id="creator">
        <div class="grid">

            <!-- FORM -->
            <div class="card">
                <div class="card-title">Create Your Token</div>
                <div class="card-sub">Fill in the details below</div>

                <div id="tokenStatus" class="status-box"></div>

                <div class="field">
                    <label>Token Name <span class="req">*</span></label>
                    <input type="text" id="tName" placeholder="e.g. My Awesome Token" required>
                </div>

                <div class="field">
                    <label>Symbol <span class="req">*</span></label>
                    <input type="text" id="tSymbol" placeholder="e.g. MAT" maxlength="8" required>
                    <small>Max 8 characters</small>
                </div>

                <div class="field">
                    <label>Decimals</label>
                    <input type="number" id="tDecimals" value="6" min="0" max="9">
                    <small>Recommended: 6</small>
                </div>

                <div class="field">
                    <label>Supply <span class="req">*</span></label>
                    <input type="number" id="tSupply" placeholder="e.g. 1000000" required>
                </div>

                <div class="field">
                    <label>Description</label>
                    <textarea id="tDesc" placeholder="Describe your token‚Ä¶"></textarea>
                </div>

                <div class="field">
                    <label>Token Image</label>
                    <div class="upload-box" id="uploadBox">
                        <div class="upload-icon">üñºÔ∏è</div>
                        <div class="upload-hint">Click to upload or drag & drop</div>
                        <small style="color:var(--text-muted);margin-top:.3rem;display:block;">PNG recommended ¬∑ max 5 MB</small>
                        <input type="file" id="imgInput" accept="image/*">
                    </div>
                    <div class="preview-wrap" id="previewWrap">
                        <img id="previewImg" alt="preview">
                    </div>
                </div>

                <!-- Advanced -->
                <button class="adv-btn" id="advBtn">Show Advanced Options ‚ñº</button>

                <div class="adv-wrap" id="advWrap">
                    <div class="toggle-row">
                        <div>
                            <div class="toggle-row-label">Revoke Freeze Authority</div>
                            <div class="toggle-row-desc">Required to create liquidity pools</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="freezeCk" checked>
                            <span class="track"></span>
                        </label>
                    </div>
                    <div class="toggle-row">
                        <div>
                            <div class="toggle-row-label">Revoke Mint Authority</div>
                            <div class="toggle-row-desc">Prevents minting additional tokens</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="mintCk">
                            <span class="track"></span>
                        </label>
                    </div>
                </div>

                <button class="create-btn" id="createBtn" disabled>Connect Wallet to Create Token</button>
            </div>

            <!-- SIDEBAR -->
            <aside class="sidebar">
                <div class="card">
                    <div class="card-title" style="margin-bottom:1rem">Summary</div>
                    <div class="summary-row"><span>Wallet</span><span id="sumWallet">Not connected</span></div>
                    <div class="summary-row"><span>Network</span><span id="sumNetwork">Devnet</span></div>
                    <div class="summary-row"><span>Revoke Freeze</span><span id="sumFreeze">Yes</span></div>
                    <div class="summary-row"><span>Revoke Mint</span><span id="sumMint">No</span></div>
                    <div class="summary-row total"><span>Network Fee</span><span>~0.01 SOL</span></div>
                </div>
            </aside>

        </div>
    </section>

    <!-- LIQUIDITY -->
    <section class="mt4" id="liquidity">
        <div class="section-title">Create Liquidity Pool</div>
        <div class="section-sub">Pair your token with SOL to enable trading on Raydium</div>

        <div class="card">
            <div class="info-banner">
                ‚ÑπÔ∏è You must have Revoke Freeze Authority enabled when creating your token before adding liquidity. You will need SOL and your tokens in your wallet.
            </div>

            <div id="liqStatus" class="status-box"></div>

            <div class="field">
                <label>Token Mint Address <span class="req">*</span></label>
                <input type="text" id="lMint" placeholder="Paste your token mint address">
                <small>The mint address received after creating your token</small>
            </div>

            <div class="field">
                <label>Token Amount <span class="req">*</span></label>
                <input type="number" id="lTokenAmt" placeholder="e.g. 500000">
                <small>How many tokens to deposit into the pool</small>
            </div>

            <div class="field">
                <label>SOL Amount <span class="req">*</span></label>
                <input type="number" id="lSolAmt" placeholder="e.g. 1.5" step="0.01">
                <small>How much SOL to pair with the tokens</small>
            </div>

            <button class="create-btn" id="liqBtn" disabled>Connect Wallet to Add Liquidity</button>
        </div>
    </section>

    <!-- HOW TO USE -->
    <section class="mt4" id="how-to">
        <div class="section-title">How to Use</div>
        <div class="section-sub">Create your token in six simple steps</div>
        <div class="steps">
            <div class="step"><div class="step-num">1</div><h4>Connect Wallet</h4><p>Click "Connect Wallet" and approve in Phantom or Solflare.</p></div>
            <div class="step"><div class="step-num">2</div><h4>Choose Network</h4><p>Test on Devnet first, then switch to Mainnet for real tokens.</p></div>
            <div class="step"><div class="step-num">3</div><h4>Token Details</h4><p>Enter name, symbol, decimals and total supply.</p></div>
            <div class="step"><div class="step-num">4</div><h4>Upload Image</h4><p>Add a logo so your token looks professional on explorers.</p></div>
            <div class="step"><div class="step-num">5</div><h4>Advanced Options</h4><p>Optionally revoke Freeze and Mint authorities.</p></div>
            <div class="step"><div class="step-num">6</div><h4>Create & Add Liquidity</h4><p>Approve transactions in your wallet ‚Äî tokens land in seconds.</p></div>
        </div>
    </section>

    <!-- FAQ -->
    <section class="mt4" id="faq">
        <div class="section-title">FAQ</div>
        <div class="section-sub">Common questions answered</div>

        <div class="faq-item">
            <div class="faq-q">What is the Solana Token Creator? <span class="faq-icon">+</span></div>
            <div class="faq-a">A free, no-code tool to create SPL tokens on the Solana blockchain. No service fees ‚Äî you only pay the tiny Solana network fee (~0.01 SOL).</div>
        </div>
        <div class="faq-item">
            <div class="faq-q">Is it safe? <span class="faq-icon">+</span></div>
            <div class="faq-a">Yes. All transactions go through your own wallet. Your private keys never leave your device. Every transaction requires your explicit approval.</div>
        </div>
        <div class="faq-item">
            <div class="faq-q">How much does it cost? <span class="faq-icon">+</span></div>
            <div class="faq-a">Zero service fees. You only pay the unavoidable Solana network fees, typically around 0.005‚Äì0.015 SOL total.</div>
        </div>
        <div class="faq-item">
            <div class="faq-q">Why revoke Freeze Authority? <span class="faq-icon">+</span></div>
            <div class="faq-a">Raydium and most DEXes require the freeze authority to be revoked before you can create a liquidity pool for your token.</div>
        </div>
        <div class="faq-item">
            <div class="faq-q">Which wallets are supported? <span class="faq-icon">+</span></div>
            <div class="faq-a">Phantom, Solflare, Backpack, and any other wallet that injects window.solana. Phantom is recommended.</div>
        </div>
        <div class="faq-item">
            <div class="faq-q">What happens after creation? <span class="faq-icon">+</span></div>
            <div class="faq-a">The entire token supply is sent to your wallet. You'll get the mint address ‚Äî use it to add liquidity or share with your community.</div>
        </div>
    </section>

</main>

<!-- ‚ñë‚ñë FOOTER ‚ñë‚ñë -->
<footer class="footer">
    <div class="footer-links">
        <a onclick="go('creator')">Token Creator</a>
        <a onclick="go('liquidity')">Create Liquidity</a>
        <a onclick="go('how-to')">How to Use</a>
        <a onclick="go('faq')">FAQ</a>
    </div>
    <div class="footer-copy">¬© 2024 Solana Token Creator ¬∑ All transactions are final ¬∑ Only pay network fees</div>
</footer>

<!-- ‚ñë‚ñë SOLANA WEB3 ‚Äî pinned versions that actually resolve on unpkg ‚ñë‚ñë -->
<script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
<script src="https://unpkg.com/@solana/buffer-layout@4.0.1/lib/Layout.js"></script>
<script src="https://unpkg.com/@solana/spl-token@0.3.8/lib/index.iife.js"></script>

<script>
/* ===================================================
   APP STATE
=================================================== */
var SOL = null;     // solanaWeb3
var SPL = null;     // splToken
var conn = null;
var walletPub = null;
var network = 'devnet';

var RPC = {
    devnet:  'https://api.devnet.solana.com',
    mainnet: 'https://solana-mainnet.g.alchemy.com/v2/demo'
};

/* ===================================================
   LIBRARY BOOT ‚Äî check every 150ms until loaded
=================================================== */
function boot() {
    SOL = window.solanaWeb3 || null;
    SPL = window.splToken   || null;

    if (!SOL || !SPL) {
        setTimeout(boot, 150);
        return;
    }

    makeConnection();
    bindAll();
}

function makeConnection() {
    conn = new SOL.Connection(RPC[network], 'confirmed');
}

/* ===================================================
   BIND EVERY INTERACTION
=================================================== */
function bindAll() {
    /* Network buttons */
    document.getElementById('devBtn').onclick = function() { setNetwork('devnet', this); };
    document.getElementById('mainBtn').onclick = function() { setNetwork('mainnet', this); };

    /* Wallet button */
    document.getElementById('walletBtn').onclick = handleWallet;

    /* Image upload */
    var box   = document.getElementById('uploadBox');
    var input = document.getElementById('imgInput');
    var wrap  = document.getElementById('previewWrap');
    var img   = document.getElementById('previewImg');

    box.addEventListener('click', function(e) {
        if (e.target !== input) input.click();
    });

    input.addEventListener('change', function() {
        var file = this.files[0];
        if (!file) return;
        var reader = new FileReader();
        reader.onload = function(e) {
            img.src = e.target.result;
            wrap.style.display = 'block';
        };
        reader.readAsDataURL(file);
    });

    box.addEventListener('dragover', function(e) {
        e.preventDefault();
        box.classList.add('drag');
    });

    box.addEventListener('dragleave', function() {
        box.classList.remove('drag');
    });

    box.addEventListener('drop', function(e) {
        e.preventDefault();
        box.classList.remove('drag');
        var file = e.dataTransfer.files[0];
        if (!file || !file.type.startsWith('image/')) return;
        var reader = new FileReader();
        reader.onload = function(ev) {
            img.src = ev.target.result;
            wrap.style.display = 'block';
        };
        reader.readAsDataURL(file);
    });

    /* Advanced options */
    var advBtn  = document.getElementById('advBtn');
    var advWrap = document.getElementById('advWrap');
    advBtn.onclick = function() {
        var open = advWrap.classList.toggle('open');
        advBtn.textContent = open ? 'Hide Advanced Options ‚ñ≤' : 'Show Advanced Options ‚ñº';
    };

    /* Toggle summary */
    document.getElementById('freezeCk').onchange = updateSummary;
    document.getElementById('mintCk').onchange = updateSummary;

    /* Create token */
    document.getElementById('createBtn').onclick = handleCreate;

    /* Liquidity */
    document.getElementById('liqBtn').onclick = handleLiquidity;

    /* FAQ */
    document.querySelectorAll('.faq-q').forEach(function(q) {
        q.onclick = function() {
            var item = q.closest('.faq-item');
            var wasOpen = item.classList.contains('open');
            document.querySelectorAll('.faq-item.open').forEach(function(i) { i.classList.remove('open'); });
            if (!wasOpen) item.classList.add('open');
        };
    });
}

/* ===================================================
   NETWORK
=================================================== */
function setNetwork(net, btn) {
    if (walletPub) {
        setStatus('tokenStatus', 'Disconnect your wallet before switching networks.', 'err');
        return;
    }
    network = net;
    makeConnection();
    document.querySelectorAll('.net-btn').forEach(function(b) { b.classList.remove('active'); });
    btn.classList.add('active');
    document.getElementById('sumNetwork').textContent = net === 'mainnet' ? 'Mainnet' : 'Devnet';
    setStatus('tokenStatus', 'Switched to ' + net, 'ok');
}

/* ===================================================
   WALLET
=================================================== */
async function handleWallet() {
    if (walletPub) {
        disconnectWallet();
    } else {
        await connectWallet();
    }
}

async function connectWallet() {
    var btn = document.getElementById('walletBtn');
    if (!window.solana || !window.solana.isPhantom) {
        setStatus('tokenStatus', 'Phantom wallet not found. Install it from phantom.app', 'err');
        window.open('https://phantom.app/', '_blank');
        return;
    }
    try {
        btn.textContent = 'Connecting‚Ä¶';
        var resp = await window.solana.connect();
        walletPub = resp.publicKey;

        var addr = walletPub.toString();
        var short = addr.slice(0,4) + '‚Ä¶' + addr.slice(-4);

        btn.textContent = short;
        btn.classList.add('connected');

        document.getElementById('sumWallet').textContent = short;
        document.getElementById('createBtn').disabled = false;
        document.getElementById('createBtn').textContent = 'Create Token';
        document.getElementById('liqBtn').disabled = false;
        document.getElementById('liqBtn').textContent = 'Create Liquidity Pool';

        setStatus('tokenStatus', '‚úÖ Wallet connected: ' + short, 'ok');

        // listen for disconnect
        window.solana.on('disconnect', disconnectWallet);
        window.solana.on('accountChanged', function(pk) {
            if (pk) { walletPub = pk; } else { disconnectWallet(); }
        });
    } catch(e) {
        btn.textContent = 'Connect Wallet';
        setStatus('tokenStatus', 'Connection cancelled or failed: ' + e.message, 'err');
    }
}

function disconnectWallet() {
    if (window.solana && window.solana.disconnect) {
        try { window.solana.disconnect(); } catch(e) {}
    }
    walletPub = null;
    var btn = document.getElementById('walletBtn');
    btn.textContent = 'Connect Wallet';
    btn.classList.remove('connected');
    document.getElementById('sumWallet').textContent = 'Not connected';
    document.getElementById('createBtn').disabled = true;
    document.getElementById('createBtn').textContent = 'Connect Wallet to Create Token';
    document.getElementById('liqBtn').disabled = true;
    document.getElementById('liqBtn').textContent = 'Connect Wallet to Add Liquidity';
    setStatus('tokenStatus', 'Wallet disconnected.', 'info');
}

/* ===================================================
   SUMMARY
=================================================== */
function updateSummary() {
    document.getElementById('sumFreeze').textContent = document.getElementById('freezeCk').checked ? 'Yes' : 'No';
    document.getElementById('sumMint').textContent   = document.getElementById('mintCk').checked   ? 'Yes' : 'No';
}

/* ===================================================
   CREATE TOKEN
=================================================== */
async function handleCreate() {
    if (!walletPub) { setStatus('tokenStatus','Connect your wallet first.','err'); return; }
    if (!conn)      { setStatus('tokenStatus','Connection not ready.','err'); return; }

    var name    = document.getElementById('tName').value.trim();
    var symbol  = document.getElementById('tSymbol').value.trim();
    var decimals= parseInt(document.getElementById('tDecimals').value) || 6;
    var supply  = parseInt(document.getElementById('tSupply').value);

    if (!name || !symbol || isNaN(supply) || supply <= 0) {
        setStatus('tokenStatus','Please fill in Name, Symbol and Supply.','err');
        return;
    }

    var revokeFreeze = document.getElementById('freezeCk').checked;
    var revokeMint   = document.getElementById('mintCk').checked;

    var btn = document.getElementById('createBtn');
    btn.disabled = true;
    btn.textContent = 'Working‚Ä¶';

    try {
        // ‚îÄ‚îÄ Step 1: create mint account ‚îÄ‚îÄ
        setStatus('tokenStatus', '1/5 ¬∑ Creating mint account‚Ä¶', 'info');

        var mintKp  = SOL.Keypair.generate();
        var lamports = await SPL.getMinimumBalanceForRentExemptMint(conn);

        var tx1 = new SOL.Transaction().add(
            SOL.SystemProgram.createAccount({
                fromPubkey: walletPub,
                newAccountPubkey: mintKp.publicKey,
                space: SPL.MINT_SIZE,
                lamports: lamports,
                programId: SPL.TOKEN_PROGRAM_ID
            }),
            SPL.createInitializeMintInstruction(
                mintKp.publicKey,
                decimals,
                walletPub,
                revokeMint ? null : walletPub,
                SPL.TOKEN_PROGRAM_ID
            )
        );

        var bh1 = await conn.getLatestBlockhash();
        tx1.recentBlockhash = bh1.blockhash;
        tx1.feePayer = walletPub;
        tx1.partialSign(mintKp);

        setStatus('tokenStatus', '1/5 ¬∑ Approve in wallet‚Ä¶', 'info');
        var sig1 = await window.solana.signAndSendTransaction(tx1);
        await conn.confirmTransaction(sig1.signature, 'confirmed');

        // ‚îÄ‚îÄ Step 2: create ATA ‚îÄ‚îÄ
        setStatus('tokenStatus', '2/5 ¬∑ Creating token account‚Ä¶', 'info');
        var ata = await SPL.getAssociatedTokenAddress(mintKp.publicKey, walletPub, false, SPL.TOKEN_PROGRAM_ID);

        var tx2 = new SOL.Transaction().add(
            SPL.createAssociatedTokenAccountInstruction(
                walletPub, ata, walletPub, mintKp.publicKey, SPL.TOKEN_PROGRAM_ID
            )
        );
        var bh2 = await conn.getLatestBlockhash();
        tx2.recentBlockhash = bh2.blockhash;
        tx2.feePayer = walletPub;
        var sig2 = await window.solana.signAndSendTransaction(tx2);
        await conn.confirmTransaction(sig2.signature, 'confirmed');

        // ‚îÄ‚îÄ Step 3: mint supply ‚îÄ‚îÄ
        setStatus('tokenStatus', '3/5 ¬∑ Minting tokens‚Ä¶', 'info');
        var amount = BigInt(supply) * BigInt(Math.pow(10, decimals));

        var tx3 = new SOL.Transaction().add(
            SPL.createMintToInstruction(
                mintKp.publicKey, ata, walletPub, amount, [], SPL.TOKEN_PROGRAM_ID
            )
        );
        var bh3 = await conn.getLatestBlockhash();
        tx3.recentBlockhash = bh3.blockhash;
        tx3.feePayer = walletPub;
        var sig3 = await window.solana.signAndSendTransaction(tx3);
        await conn.confirmTransaction(sig3.signature, 'confirmed');

        // ‚îÄ‚îÄ Step 4: revoke freeze ‚îÄ‚îÄ
        if (revokeFreeze) {
            setStatus('tokenStatus', '4/5 ¬∑ Revoking freeze authority‚Ä¶', 'info');
            var tx4 = new SOL.Transaction().add(
                SPL.createSetAuthorityInstruction(
                    mintKp.publicKey, walletPub,
                    SPL.AuthorityType.FreezeAccount, null, [], SPL.TOKEN_PROGRAM_ID
                )
            );
            var bh4 = await conn.getLatestBlockhash();
            tx4.recentBlockhash = bh4.blockhash;
            tx4.feePayer = walletPub;
            var sig4 = await window.solana.signAndSendTransaction(tx4);
            await conn.confirmTransaction(sig4.signature, 'confirmed');
        }

        // ‚îÄ‚îÄ Step 5: revoke mint ‚îÄ‚îÄ
        if (revokeMint) {
            setStatus('tokenStatus', '5/5 ¬∑ Revoking mint authority‚Ä¶', 'info');
            var tx5 = new SOL.Transaction().add(
                SPL.createSetAuthorityInstruction(
                    mintKp.publicKey, walletPub,
                    SPL.AuthorityType.MintTokens, null, [], SPL.TOKEN_PROGRAM_ID
                )
            );
            var bh5 = await conn.getLatestBlockhash();
            tx5.recentBlockhash = bh5.blockhash;
            tx5.feePayer = walletPub;
            var sig5 = await window.solana.signAndSendTransaction(tx5);
            await conn.confirmTransaction(sig5.signature, 'confirmed');
        }

        var mintAddr = mintKp.publicKey.toString();
        var explorerBase = network === 'mainnet'
            ? 'https://solscan.io/token/' + mintAddr
            : 'https://solscan.io/token/' + mintAddr + '?cluster=devnet';

        document.getElementById('tokenStatus').innerHTML =
            '<strong>‚úÖ Token created!</strong><br>' +
            'Mint: <code>' + mintAddr + '</code>' +
            '<span class="copy-tag" onclick="copy(\'' + mintAddr + '\')">Copy</span><br>' +
            '<a href="' + explorerBase + '" target="_blank" style="color:var(--primary);">View on Solscan ‚Üó</a>';
        document.getElementById('tokenStatus').className = 'status-box show ok';

        // auto-fill liquidity form
        document.getElementById('lMint').value = mintAddr;

    } catch(e) {
        console.error(e);
        setStatus('tokenStatus', '‚ùå Error: ' + e.message, 'err');
    } finally {
        btn.disabled = false;
        btn.textContent = 'Create Token';
    }
}

/* ===================================================
   LIQUIDITY
=================================================== */
async function handleLiquidity() {
    if (!walletPub) { setStatus('liqStatus','Connect your wallet first.','err'); return; }

    var mint   = document.getElementById('lMint').value.trim();
    var tokAmt = parseFloat(document.getElementById('lTokenAmt').value);
    var solAmt = parseFloat(document.getElementById('lSolAmt').value);

    if (!mint || isNaN(tokAmt) || isNaN(solAmt) || tokAmt <= 0 || solAmt <= 0) {
        setStatus('liqStatus','Please fill in all liquidity fields.','err');
        return;
    }

    setStatus('liqStatus',
        '‚ÑπÔ∏è Liquidity pool creation is handled directly on Raydium. ' +
        'Your mint address has been ready to use. ' +
        'Visit raydium.io ‚Üí Liquidity ‚Üí Create Pool and paste your mint address: ' + mint,
        'info'
    );
}

/* ===================================================
   HELPERS
=================================================== */
function setStatus(id, msg, type) {
    var el = document.getElementById(id);
    el.textContent = msg;
    el.className = 'status-box show ' + (type === 'ok' ? 'ok' : type === 'err' ? 'err' : 'info');
}

function copy(text) {
    navigator.clipboard.writeText(text).then(function() {
        alert('Copied: ' + text);
    });
}

function go(id) {
    var el = document.getElementById(id);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

updateSummary();
boot();
</script>
</body>
</html>
